<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SM VOICE â€“ True ChatGPT</title>

<style>
:root{--bg:#020617;--panel:#0f172a;--user:#2563eb;--ai:#1e293b;--text:#e5e7eb}
*{box-sizing:border-box;font-family:system-ui}
body{
  margin:0;height:100vh;background:#020617;color:var(--text);
  display:flex;flex-direction:column
}
.header{padding:14px;text-align:center;font-weight:700;border-bottom:1px solid #1e293b}
.chat{flex:1;padding:16px;overflow-y:auto;display:flex;flex-direction:column;gap:12px}
.bubble{max-width:85%;padding:14px 16px;border-radius:22px}
.user{background:#2563eb;align-self:flex-end}
.ai{background:#1e293b;align-self:flex-start}
.footer{padding:20px;display:flex;justify-content:center}
.voice{
  width:120px;height:120px;border-radius:50%;
  background:#22c55e;display:flex;align-items:center;justify-content:center
}
.voice.listening{background:#ef4444}
.wave{display:flex;gap:6px}
.wave span{
  width:6px;height:22px;background:white;border-radius:6px;
  animation:wave 1s infinite ease-in-out
}
.wave span:nth-child(2){animation-delay:.1s}
.wave span:nth-child(3){animation-delay:.2s}
@keyframes wave{50%{height:40px}}
</style>
</head>

<body>

<div class="header">ðŸŽ§ SM VOICE â€“ True ChatGPT</div>

<div id="chat" class="chat">
  <div class="bubble ai">I am ready. Speak now.</div>
</div>

<div class="footer">
  <div id="voice" class="voice">
    <div class="wave"><span></span><span></span><span></span></div>
  </div>
</div>

<script>
const WORKER_URL = "https://YOUR-WORKER-URL.workers.dev";

const chat = document.getElementById("chat");
const voice = document.getElementById("voice");

const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
const recognition = new SR();
recognition.lang = "en-US";

let speaking = false;

recognition.onstart = ()=> voice.classList.add("listening");
recognition.onend = ()=> voice.classList.remove("listening");

recognition.onresult = e=>{
  const text = e.results[0][0].transcript;
  add(text,"user");
  askChatGPT(text);
};

function add(t,c){
  const d=document.createElement("div");
  d.className="bubble "+c;
  d.textContent=t;
  chat.appendChild(d);
  chat.scrollTop=chat.scrollHeight;
}

function speak(text){
  speaking = true;
  speechSynthesis.cancel();
  const u = new SpeechSynthesisUtterance(text);
  u.onend = ()=>{
    speaking=false;
    recognition.start();
  };
  speechSynthesis.speak(u);
}

async function askChatGPT(q){
  speak("Thinking");
  try{
    const r = await fetch(WORKER_URL,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({text:q})
    });
    const d = await r.json();
    add(d.reply,"ai");
    speak(d.reply);
  }catch{
    speak("Connection error");
  }
}

setTimeout(()=>recognition.start(),1000);
</script>

</body>
</html>